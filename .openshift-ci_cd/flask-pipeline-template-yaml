apiVersion: v1
kind: Template
metadata:
  name: flask-pipeline
  annotations:
    desrciption: "Template for generating BuildConfigs with jenkinsPipelineStrategy."
    tags: ""
parameters:
- name: "GIT_URL"
  displayName: "Git URL"
  description: "URL to git source repository containing Jenkinsfile."
  required: true
- name: "GIT_REF"
  displayName: "Git Reference"
  description: "Git reference. (branch, ...)"
  value: "master"
- name: "GITHUB_WEBHOOK_SECRET"
  displayName: "GitHub Webhook secret"
  required: true
objects:
- kind: BuildConfig
  apiVersion: v1
  metadata:
    name: flask-sandbox-pipeline
    labels:
      app: flask-sandbox
    annotations:
      pipeline.alpha.openshift.io/uses: '[{"name": "flask-sandbox-dev", "namespace": "", "kind": "DeploymentConfig"},{"name": "flask-sandbox-test", "namespace": "", "kind": "DeploymentConfig"},{"name": "flask-sandbox-prod", "namespace": "", "kind": "DeploymentConfig"}]'
  spec:
    triggers:
      -
        type: GitHub
        github:
          secret: "${GITHUB_WEBHOOK_SECRET}"
    strategy:
      type: JenkinsPipeline
      jenkinsPipelineStrategy:
        jenkinsfilePath: .openshift-ci_cd/Jenkinsfile
    source:
      type: git
      git:
        uri: ${GIT_URL}
        ref: ${GIT_REF}
